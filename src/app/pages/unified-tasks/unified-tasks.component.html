<div class="tasks">
  <div class="tasks-container">
    <header class="tasks-header">
      <h1 class="tasks-title">Task Manager</h1>
      
      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'kitsui'"
          (click)="switchTab('kitsui')"
        >
          Kitsui
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'bubble'"
          (click)="switchTab('bubble')"
        >
          Bubble
        </button>
      </div>
    </header>

    <div class="tasks-input-section">
      <div class="label-radio-group">
        <div class="label-radio-item" *ngFor="let label of currentLabels">
          <input 
            type="radio" 
            [id]="'label-' + label.id"
            [value]="label.id" 
            [(ngModel)]="selectedLabel"
            [name]="activeTab + 'TaskLabel'"
            class="label-radio-input"
          >
          <label 
            [for]="'label-' + label.id"
            class="label-radio-label"
            [style.border-color]="label.color"
            [style.--label-color]="label.color"
          >
            <span 
              class="label-color-dot" 
              [style.background-color]="label.color"
            ></span>
            {{ label.name }}
          </label>
        </div>
      </div>
      <div class="input-and-button">
        <input 
          type="text" 
          [(ngModel)]="newTaskText"
          (keypress)="onKeyPress($event)"
          placeholder="Add a new task..."
          class="tasks-input"
          maxlength="200"
        >
        <button 
          (click)="addTask()" 
          class="tasks-add-btn"
          [disabled]="!newTaskText.trim()"
        >
          +
        </button>
      </div>
    </div>

    <div class="tasks-columns">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading {{ activeTab }} tasks...</p>
      </div>

      <!-- Left Column: All Tasks -->
      <div class="tasks-column" *ngIf="!isLoading">
        <h2 class="column-title">All Tasks</h2>
        <div 
          class="tasks-list drop-zone"
          (dragover)="onDragOver($event)"
          (drop)="onDropToTasks($event)"
        >
          <div 
            *ngFor="let task of sortedTasks" 
            class="task-item"
            [class.completed]="task.completed"
            [class.priority-task]="task.isPriority"
            draggable="true"
            (dragstart)="onDragStart($event, task)"
          >
            <label class="task-checkbox-container">
              <input 
                type="checkbox" 
                [checked]="task.completed"
                (change)="toggleTask(task)"
                class="task-checkbox"
              >
              <span class="task-checkmark"></span>
            </label>
            
            <span class="task-text">{{ task.text }}</span>
            
            <span 
              *ngIf="task.label" 
              class="task-label"
              [style.background-color]="getLabelColor(task.label)"
              [title]="getLabelName(task.label)"
            >
              {{ getLabelName(task.label) }}
            </span>
            
            <button 
              (click)="openTaskModal(task)" 
              class="task-menu-btn"
              title="Options"
            >
              ⋯
            </button>
          </div>
          
          <div class="tasks-empty" *ngIf="sortedTasks.length === 0">
            <p class="tasks-empty-text">No tasks yet. Add one above!</p>
          </div>
        </div>
      </div>

      <!-- Right Column: Today Tasks -->
      <div class="tasks-column" *ngIf="!isLoading">
        <h2 class="column-title">Today</h2>
        <div 
          class="tasks-list drop-zone today-zone"
          (dragover)="onDragOver($event)"
          (drop)="onDropToToday($event)"
        >
          <div 
            *ngFor="let task of todayTasks" 
            class="task-item today-task"
            [class.completed]="task.completed"
            [class.priority-task]="task.isPriority"
            draggable="true"
            (dragstart)="onDragStart($event, task)"
          >
            <label class="task-checkbox-container">
              <input 
                type="checkbox" 
                [checked]="task.completed"
                (change)="toggleTask(task)"
                class="task-checkbox"
              >
              <span class="task-checkmark"></span>
            </label>
            
            <span class="task-text">{{ task.text }}</span>
            
            <span 
              *ngIf="task.label" 
              class="task-label"
              [style.background-color]="getLabelColor(task.label)"
              [title]="getLabelName(task.label)"
            >
              {{ getLabelName(task.label) }}
            </span>
            
            <button 
              (click)="openTaskModal(task)" 
              class="task-menu-btn"
              title="Options"
            >
              ⋯
            </button>
          </div>
          
          <div class="tasks-empty" *ngIf="todayTasks.length === 0">
            <p class="tasks-empty-text">Drag tasks here for today!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Affichage des erreurs -->
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>
  </div>

  <!-- Modal des actions -->
  <div 
    *ngIf="showTaskModal" 
    class="modal-overlay"
    (click)="closeTaskModal()"
  >
    <div class="task-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Task Actions</h3>
        <button (click)="closeTaskModal()" class="close-btn">×</button>
      </div>
      
      <div class="modal-content" *ngIf="selectedTask">
        <div class="task-preview">
          <strong>{{ selectedTask.text }}</strong>
          <span class="task-info">
            {{ getLabelName(selectedTask.label || '') }}
            <span *ngIf="selectedTask.isPriority" class="priority-badge">Pinned</span>
          </span>
        </div>
        
        <div class="modal-actions">
          <div class="action-btn rename-btn" [class.renaming]="isRenaming">
            <div *ngIf="!isRenaming" (click)="startRename()" class="rename-trigger">
              ✏️ Rename
            </div>
            <div *ngIf="isRenaming" class="rename-input-container">
              <input 
                [(ngModel)]="renameText"
                (keydown)="onRenameKeyPress($event)"
                (blur)="saveRename()"
                class="rename-input"
                #renameInput
                maxlength="200"
              >
              <div class="rename-actions">
                <button (click)="saveRename()" class="save-btn">✓</button>
                <button (click)="cancelRename()" class="cancel-btn">×</button>
              </div>
            </div>
          </div>
          
          <button (click)="toggleTaskPriority()" class="action-btn priority-btn">
            <span *ngIf="!selectedTask.isPriority">📌 Pin this task</span>
            <span *ngIf="selectedTask.isPriority">📌 Unpin task</span>
          </button>
          
          <button (click)="deleteTaskFromModal()" class="action-btn delete-btn">
            🗑️ Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>