<div class="container">
  <div class="header">
    <div class="header-content">
      <div class="bot-info">
        <div class="bot-avatar">
          <img src="assets/images/cozybot/cozybot-logo3.png" alt="CozyBot Logo" />
        </div>
        <div class="bot-details">
          <h1 [class.animating]="animatingTitle">CozyBot</h1>
          <p class="bot-description">Discord Bot ‚Ä¢ Leaderboard</p>
          <div class="view-selector">
            <select [(ngModel)]="selectedView" (change)="onViewChange()" class="view-select">
              <option value="users">Top Users</option>
              <option value="servers">Top Servers</option>
              <option value="sounds">Top Sounds</option>
            </select>
            <a href="https://discord.com/oauth2/authorize?client_id=1156917047284994178&permissions=8&scope=bot" 
               target="_blank" 
               class="add-to-server-btn">
              Add to your Discord server
            </a>
          </div>
        </div>
      </div>
      <div class="stats">
        <div class="stat-card">
          <span class="stat-number" [class.animating]="animatingUsers">{{ getTotalUsers() }}</span>
          <span class="stat-label">Total Users</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" [class.animating]="animatingTotalServers">{{ liveStats.total_servers }}</span>
          <span class="stat-label">Total Servers</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" [class.animating]="animatingTime">{{ getTotalTimeDays() }}</span>
          <span class="stat-label">Total Time</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Live Stats en haut au centre en gros -->
  <div class="live-stats-section">
    <div class="live-stats">
      <div class="live-stat-combined" [class.loading]="statsLoading">
        <span class="live-stat-text">
          <span class="live-stat-number" 
                [class.animating]="animatingListeners"
                [class.pulse-glow]="liveStats.current_listeners > 0">{{ liveStats.current_listeners }}</span>
          <span class="live-stat-word">{{ liveStats.current_listeners === 1 ? 'person' : 'people' }} in</span>
          <span class="live-stat-number" 
                [class.animating]="animatingServers"
                [class.pulse-glow]="liveStats.servers_with_bot > 0">{{ liveStats.servers_with_bot }}</span>
          <span class="live-stat-word">{{ liveStats.servers_with_bot === 1 ? 'server' : 'servers' }}</span>
        </span>
        <span class="live-stat-label">üéß listening now</span>
      </div>
    </div>
  </div>

  <!-- How to earn points link -->
  <div class="points-info-section">
    <div class="points-info">
      <a href="/cozypoints" class="points-link">How to earn points? ‚Üí</a>
    </div>
  </div>

  <div class="leaderboard-section">
    <div class="section-header">
      <h2 *ngIf="selectedView === 'users'">üèÜ Top CozyBot users by CozyPoints</h2>
      <h2 *ngIf="selectedView === 'servers'">üèÜ Top CozyBot servers by listening time</h2>
      <h2 *ngIf="selectedView === 'sounds'">üèÜ Top CozyBot sounds by listening time</h2>
      <p *ngIf="selectedView === 'users'">Ranking based on Discord activity</p>
      <p *ngIf="selectedView === 'servers'">Ranking based on total listening time</p>
      <p *ngIf="selectedView === 'sounds'">Ranking based on total listening time</p>
      <div *ngIf="selectedView === 'users'" class="total-points-display">
        <span class="points-number" [class.animating]="animatingPoints">{{ getTotalPoints() | number }}</span>
        <span class="points-label">Total CozyPoints earned by all users</span>
      </div>
      <div *ngIf="selectedView === 'sounds'" class="total-sessions-display">
        <span class="sessions-number" [class.animating]="animatingSessions">{{ getTotalSessions() | number }}</span>
        <span class="sessions-label">Total Sessions played by all users</span>
      </div>
      
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Loading leaderboard...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error }}</p>
    </div>

    <!-- Users Leaderboard -->
    <div *ngIf="!loading && !error && selectedView === 'users'" class="leaderboard">
      <!-- Top 3 Podium - only on page 1 -->
      <div *ngIf="currentPage === 1" class="podium users-podium">
        <div *ngFor="let user of getTopThree(); let i = index" 
             class="podium-item" 
             [class.first]="i === 0" 
             [class.second]="i === 1" 
             [class.third]="i === 2">
          <div class="podium-rank">{{ getRankEmoji(user.rank) }}</div>
          <div class="podium-user">
            <div class="user-avatar"><span class="emoji-only">{{ getFavoriteSoundEmoji(user) }}</span></div>
            <div class="user-name">{{ getDisplayName(user) }}</div>
            <div class="user-stats">
              <div class="user-points">{{ formatPoints(user.total_points) }} pts</div>
              <div class="user-level">Level {{ user.level }}</div>
              <div class="user-time">
                <span class="desktop-text">{{ getListeningTimeDays(user.listening_time_seconds) }} <small class="favorite-sound">{{ getFavoriteSound(user) }}</small></span>
                <span class="mobile-text">{{ getListeningTimeDays(user.listening_time_seconds) }} <small class="favorite-sound">{{ getFavoriteSound(user) }}</small></span>
              </div>
              <div class="user-streak" *ngIf="user.daily_streak && user.daily_streak > 0"><span class="emoji-only">üî•</span> {{ user.daily_streak }} day streak</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Rest of leaderboard -->
      <div class="leaderboard-list users-list">
        <div *ngFor="let user of getRemainingUsers(); trackBy: trackByUserId" 
             class="leaderboard-item">
          <div class="rank-number">{{ user.rank }}</div>
          <div class="user-info">
            <div class="user-avatar-small"><span class="emoji-only">{{ getFavoriteSoundEmoji(user) }}</span></div>
            <div class="user-details">
              <span class="username">{{ getDisplayName(user) }}</span>
              <div class="user-meta">
                <span class="level-badge">Lvl {{ user.level }}</span>
                <span class="time-spent">
                  <span class="desktop-text">{{ getListeningTimeDays(user.listening_time_seconds) }} <small class="favorite-sound">{{ getFavoriteSound(user) }}</small></span>
                  <span class="mobile-text">{{ getListeningTimeDays(user.listening_time_seconds) }} <small class="favorite-sound">{{ getFavoriteSound(user) }}</small></span>
                </span>
              </div>
            </div>
          </div>
          <div class="points-section">
            <div class="points">{{ formatPoints(user.total_points) }}</div>
            <div class="points-label">CozyPoints</div>
          </div>
          <div class="streak-section">
            <span class="streak" *ngIf="user.daily_streak && user.daily_streak > 0"><span class="emoji-only">üî•</span><small>{{ user.daily_streak }}</small></span>
          </div>
        </div>
      </div>

      <!-- Pagination for Users -->
      <div *ngIf="totalPages > 1" class="pagination">
        <button class="pagination-btn" [disabled]="!hasPreviousPage" (click)="goToPreviousPage()">
          ‚Üê Previous
        </button>
        <div class="page-numbers">
          <button *ngFor="let page of getPageNumbers()" 
                  class="page-number" 
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)">
            {{ page }}
          </button>
        </div>
        <button class="pagination-btn" [disabled]="!hasNextPage" (click)="goToNextPage()">
          Next ‚Üí
        </button>
      </div>
    </div>

    <!-- Servers Leaderboard -->
    <div *ngIf="!loading && !error && selectedView === 'servers'" class="leaderboard">
      <div class="leaderboard-list">
        <div *ngFor="let server of servers; trackBy: trackByServerId" 
             class="leaderboard-item">
          <div class="user-info">
            <div class="user-avatar-small">{{ server.rank }}</div>
            <div class="user-details">
              <span class="username server-name">{{ server.server_name }}</span>
            </div>
          </div>
          <div class="points-section">
            <div class="points">{{ formatTime(server.total_time_seconds) }}</div>
            <div class="points-label">Total Time</div>
          </div>
          <div class="streak-section">
          </div>
        </div>
      </div>

      <!-- Pagination for Servers -->
      <div *ngIf="totalPages > 1" class="pagination">
        <button class="pagination-btn" [disabled]="!hasPreviousPage" (click)="goToPreviousPage()">
          ‚Üê Previous
        </button>
        <div class="page-numbers">
          <button *ngFor="let page of getPageNumbers()" 
                  class="page-number" 
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)">
            {{ page }}
          </button>
        </div>
        <button class="pagination-btn" [disabled]="!hasNextPage" (click)="goToNextPage()">
          Next ‚Üí
        </button>
      </div>
    </div>

    <!-- Sounds Leaderboard -->
    <div *ngIf="!loading && !error && selectedView === 'sounds'" class="leaderboard">
      <div class="leaderboard-list">
        <div *ngFor="let sound of sounds; let i = index; trackBy: trackBySoundName" 
             class="leaderboard-item">
          <div class="user-info">
            <div class="user-avatar-small">{{ i + 1 }}</div>
            <div class="user-details">
              <span class="username sound-name">{{ sound.display_name }}</span>
              <div class="user-meta">
                <span class="level-badge">{{ sound.total_sessions }} sessions</span>
                <span class="time-spent">{{ sound.unique_listeners }} unique listeners</span>
              </div>
            </div>
          </div>
          <div class="points-section">
            <div class="points">{{ formatTime(sound.total_time) }}</div>
            <div class="points-label">Total Time</div>
          </div>
          <div class="streak-section">
          </div>
        </div>
      </div>

      <!-- Pagination for Sounds -->
      <div *ngIf="totalPages > 1" class="pagination">
        <button class="pagination-btn" [disabled]="!hasPreviousPage" (click)="goToPreviousPage()">
          ‚Üê Previous
        </button>
        <div class="page-numbers">
          <button *ngFor="let page of getPageNumbers()"
                  class="page-number"
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)">
            {{ page }}
          </button>
        </div>
        <button class="pagination-btn" [disabled]="!hasNextPage" (click)="goToNextPage()">
          Next ‚Üí
        </button>
      </div>

      <!-- Camemberts des sons -->
      <div class="sounds-charts-wrapper" *ngIf="soundsChartData.length > 0">
        <!-- Camembert par cat√©gorie -->
        <div class="sounds-chart-section">
          <div class="sounds-chart-container">
            <ngx-charts-pie-chart
              [results]="soundsByCategoryChartData"
              [legend]="false"
              [labels]="true"
              [doughnut]="false"
              [explodeSlices]="false"
              [animations]="true"
              [view]="chartView"
              [scheme]="colorScheme"
              [trimLabels]="false"
              [labelFormatting]="formatChartLabel">
            </ngx-charts-pie-chart>
          </div>
        </div>

        <!-- Camembert par son -->
        <div class="sounds-chart-section">
          <div class="sounds-chart-container">
            <ngx-charts-pie-chart
              [results]="soundsChartData"
              [legend]="false"
              [labels]="true"
              [doughnut]="false"
              [explodeSlices]="false"
              [animations]="true"
              [view]="chartView"
              [scheme]="colorScheme"
              [trimLabels]="false"
              [labelFormatting]="formatChartLabel">
            </ngx-charts-pie-chart>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="footer-content">
    <div class="footer-main">
      <p class="developed-by">
        Developed with <span class="heart">‚ù§Ô∏è</span> by 
        <a href="https://github.com/imenemedjaoui" target="_blank" class="dev-link">&#64;BubbleXGum</a> & 
        <a href="https://github.com/kitsuiwebster" target="_blank" class="dev-link">&#64;kitsuiwebster</a>
      </p>
      <p class="version">v1.0.19</p>
    </div>
    <div class="footer-links">
      <a href="https://discord.com/discovery/applications/1156917047284994178" target="_blank" class="footer-link">
        Add to Discord
      </a>
      <a href="https://github.com/kitsuiwebster/cozy-bot" target="_blank" class="footer-link">
        GitHub
      </a>
      <a href="https://discord.gg/Rxeh64Y73U" target="_blank" class="footer-link">
        Support Discord
      </a>
      <a href="https://kitsuiwebster.com/cozybot/credits" target="_blank" class="footer-link">
        Credits
      </a>
    </div>
  </div>
</footer>