<div class="tasks">
  <div class="tasks-container">
    <header class="tasks-header">
      <h1 class="tasks-title">Kitsui Task Manager</h1>
    </header>

    <div class="tasks-input-section">
      <div class="label-radio-group">
        <div class="label-radio-item" *ngFor="let label of labels">
          <input 
            type="radio" 
            [id]="'label-' + label.id"
            [value]="label.id" 
            [(ngModel)]="selectedLabel"
            name="taskLabel"
            class="label-radio-input"
          >
          <label 
            [for]="'label-' + label.id"
            class="label-radio-label"
            [style.border-color]="label.color"
            [style.--label-color]="label.color"
          >
            <span 
              class="label-color-dot" 
              [style.background-color]="label.color"
            ></span>
            {{ label.name }}
          </label>
        </div>
      </div>
      <div class="input-and-button">
        <input 
          type="text" 
          [(ngModel)]="newTaskText"
          (keypress)="onKeyPress($event)"
          placeholder="Add a new task..."
          class="tasks-input"
          maxlength="200"
        >
        <button 
          (click)="addTask()" 
          class="tasks-add-btn"
          [disabled]="!newTaskText.trim()"
        >
          +
        </button>
      </div>
    </div>


    <div class="tasks-columns">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading tasks...</p>
      </div>

      <!-- Left Column: All Tasks -->
      <div class="tasks-column" *ngIf="!isLoading">
        <h2 class="column-title">All Tasks</h2>
        <div 
          class="tasks-list drop-zone"
          (dragover)="onDragOver($event)"
          (drop)="onDropToTasks($event)"
        >
          <div 
            *ngFor="let task of sortedTasks" 
            class="task-item"
            [class.completed]="task.completed"
            draggable="true"
            (dragstart)="onDragStart($event, task)"
          >
            <label class="task-checkbox-container">
              <input 
                type="checkbox" 
                [checked]="task.completed"
                (change)="toggleTask(task)"
                class="task-checkbox"
              >
              <span class="task-checkmark"></span>
            </label>
            
            <span class="task-text">{{ task.text }}</span>
            
            <span 
              *ngIf="task.label" 
              class="task-label"
              [style.background-color]="getLabelColor(task.label)"
              [title]="getLabelName(task.label)"
            >
              {{ getLabelName(task.label) }}
            </span>
            
            <button 
              (click)="deleteTask(task.id)" 
              class="task-delete-btn"
              title="Delete task"
            >
              ×
            </button>
          </div>
          
          <div class="tasks-empty" *ngIf="sortedTasks.length === 0">
            <p class="tasks-empty-text">No tasks yet. Add one above!</p>
          </div>
        </div>
      </div>

      <!-- Right Column: Today Tasks -->
      <div class="tasks-column" *ngIf="!isLoading">
        <h2 class="column-title">Today</h2>
        <div 
          class="tasks-list drop-zone today-zone"
          (dragover)="onDragOver($event)"
          (drop)="onDropToToday($event)"
        >
          <div 
            *ngFor="let task of todayTasks" 
            class="task-item today-task"
            [class.completed]="task.completed"
            draggable="true"
            (dragstart)="onDragStart($event, task)"
          >
            <label class="task-checkbox-container">
              <input 
                type="checkbox" 
                [checked]="task.completed"
                (change)="toggleTask(task)"
                class="task-checkbox"
              >
              <span class="task-checkmark"></span>
            </label>
            
            <span class="task-text">{{ task.text }}</span>
            
            <span 
              *ngIf="task.label" 
              class="task-label"
              [style.background-color]="getLabelColor(task.label)"
              [title]="getLabelName(task.label)"
            >
              {{ getLabelName(task.label) }}
            </span>
            
            <button 
              (click)="deleteTask(task.id)" 
              class="task-delete-btn"
              title="Delete task"
            >
              ×
            </button>
          </div>
          
          <div class="tasks-empty" *ngIf="todayTasks.length === 0">
            <p class="tasks-empty-text">Drag tasks here for today!</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>